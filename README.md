
# Prerequisites

* python >= 3.11

if you are using conda, you can create an environment with the following command:
```shell
conda env create -f environment.yml
```

or else you can install the dependencies using pip:
```shell
pip install -r requirements.txt
```

# How to Start Testing NIDS

> We utilize `docker compose` to automate the building of a network topology required for `nidsfuzz` to function. 
> **The biggest problem you might face during setup is your network speed!**

## Network Topology
```text
+-------------+        +------------------+        +----------------+
| NIDS Fuzzer | <----> | Gateway & Mirror | <----> | Tunable Server |
+-------------+        +------------------+        +----------------+
                           /          \ 
                          +            +
                   +--------+        +----------+  
                   | Snort3 |        | Suricata | 
                   +--------+        +----------+
                        （Promiscuous Mode）
```

## Usage Tutorial

First, remember to configure the fuzz seed, which is the NIDS rule file:

> 1. **Move the tested rules to the `./dockers/rules/` folder !**
> 2. **Modify the `SNORT2_RULE_FILE` and `SNORT3_RULE_FILE` parameters in the `docker-compose/config.env` file accordingly !**

To perform fuzz testing, simply run the `startup.sh` script. 

It will check for and build the essential images, including `nidsfuzz`, `mirror`, `snort3`, `suricata`, before starting the fuzzing process.

```shell
bash ./dockers/startup.sh --fuzz
```

After starting the fuzzing process, you can stop it at any time by executing the `cleanup.sh` script. 

This script will copy the `alerts\logs` generated by each module and remove all `containers`, `networks`, and `volumes` created during this `Docker Compose` session.

```shell
bash ./dockers/cleanup.sh --fuzz
```

<span style="color: #FF8C00; "> The startup.sh and cleanup.sh scripts can also be used to replay the abnormal test cases found by nidsfuzz to reproduce the inconsistent behavior of different NIDS</span>

```shell
bash ./dockers/startup.sh --replay -traffic directory/to/traffic.bin
bash ./dockers/cleanup.sh --replay
```


## Output Structure
The `cleanup.sh` will create a `logs` folder within the `dockers` directory. The directory structure is as shown below:
```text
fuzz/
│
├── fuzzer/
│   └── log/
│       ├── logs_xxxx-xx-xx_xx-xx-xx_xxxxxx/
        │   ├── alert_sanitizer.log
│       │   ├── fuzzer.log
│       │   └── traffic_injector.log
        │ 
│       ├── test.bin
│       └── test.txt
│
├── responder/
│   └── log/
│       └── logs_xxxx-xx-xx_xx-xx-xx_xxxxxx/
            ├── alert_sanitizer.log
│           ├── fuzzer.log
│           └── traffic_injector.log
│
├── snort3/
│   └── log/
│       └── snort3.log
│
├── suricata/
│   └── log/
│       ├── eve.json
│       ├── fast.log
│       ├── stats.log
│       └── suricata.log
```
